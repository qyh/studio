/*
 *
 * Professional Linux Programming - list all employees
 *
 */
#include <stdio.h>
#include <stdlib.h>
#include "libpq-fe.h"


int main(int argc, char **argv)
{
   const char *conninfo;
   PGconn *conn;
   PGresult *result;
   char *empid, *lastname, *firstname, *salary;
   float salaryval;
   int i;

   conninfo = "hostaddr = 127.0.0.1 dbname = test user = earl password = bigshot";

   conn = PQconnectdb(conninfo);
   if (PQstatus(conn) != CONNECTION_OK)
   {
      printf("Unable to establish connection: %s", 
                 PQerrorMessage(conn));
      return 1;
   } else
   {
      result = PQexec(conn, "Select * from employee order by empid");
      if (PQresultStatus(result) != PGRES_TUPLES_OK)
      {
         printf("Problem with query: %s",
                   PQerrorMessage(conn));
         return 1;
      } else
      {
         printf("ID     Name           Salary\n");
         printf("----------------------------\n");
         for(i = 0; i < PQntuples(result); i++)
         {
            empid = PQgetvalue(result, i, 0);
            lastname = PQgetvalue(result, i, 1);
            firstname = PQgetvalue(result, i, 2);
            salary = PQgetvalue(result, i, 3);
            salaryval = atof(salary);
            printf("%s  %s,%s   $%.2lf\n", empid, lastname,
                     firstname, salaryval);
         }         
         PQclear(result);
      }
   }
   PQfinish(conn);
   return 0;
}
