

  Listing 5.2




/*
 * Open CMOS bank
 */
int
cmos_open(struct inode *inode, struct file *file)
{
    struct cmos_dev *cmos_devp;

    /* Get the per-device structure that contains this cdev */
    cmos_devp = container_of(inode-&gt;i_cdev, struct cmos_dev, cdev);

    /* Easy access to cmos_devp from rest of the entry points */
    file-&gt;private_data = cmos_devp;

    /* Initialize some fields */
    cmos_devp-&gt;size = CMOS_BANK_SIZE;
    cmos_devp-&gt;current_pointer = 0;

    return 0;
}

/*
 * Release CMOS bank
 */
int
cmos_release(struct inode *inode, struct file *file
{
    struct cmos_dev *cmos_devp = file-&gt;private_data;

    /* Reset file pointer */
    cmos_devp-&gt;current_pointer = 0;

    return 0;
}



syntax highlighted by Code2HTML, v. 0.9.1


lines: 0
