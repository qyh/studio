

  Listing 12.1




#include &lt;stdio.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;linux/fb.h&gt;
#include &lt;sys/mman.h&gt;
#include &lt;stdlib.h&gt;

struct fb_var_screeninfo vinfo;

int
main(int argc, char *argv[])
{
    int fbfd, fbsize, i;
    unsigned char *fbbuf;

    /* Open video memory */
    if ((fbfd = open(&quot;/dev/fb0&quot;, O_RDWR)) &lt; 0) {
        exit(1);
    }

    /* Get variable display parameters */
    if (ioctl(fbfd, FBIOGET_VSCREENINFO, &amp;vinfo)) {
        printf(&quot;Bad vscreeninfo ioctl\n&quot;);
        exit(2);
    }

    /* Size of frame buffer =
       (X-resolution * Y-resolution * bytes per pixel) */
    fbsize = vinfo.xres*vinfo.yres*(vinfo.bits_per_pixel/8);

    /* Map video memory */
    if ((fbbuf = mmap(0, fbsize, PROT_READ|PROT_WRITE,
                      MAP_SHARED, fbfd, 0)) == (void *) -1){
        exit(3);
    }

    /* Clear the screen */
    for (i=0; i&lt;fbsize; i++) {
        *(fbbuf+i) = 0x0;
    }
    munmap(fbbuf, fbsize);

    close(fbfd);
}



syntax highlighted by Code2HTML, v. 0.9.1


lines: 0
