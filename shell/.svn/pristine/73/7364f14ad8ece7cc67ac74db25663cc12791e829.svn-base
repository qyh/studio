

  Listing 19.7




#include &lt;linux/i2c.h&gt;
#include &lt;linux/i2c-dev.h&gt;

/* Bus addresses of the memory banks */
#define SLAVE_ADDR1 0x60
#define SLAVE_ADDR2 0x61

int
main(int argc, char *argv[])
{

    /* Open the host adapter */
    if ((smbus_fp = open(&quot;/dev/i2c-0&quot;, O_RDWR)) &lt; 0) {
        exit(1);
    }

    /* Connect to the first bank */
    if (ioctl(smbus_fp, I2C_SLAVE, SLAVE_ADDR1) &lt; 0) {
        exit(1);
    }

    /* ... */

    /* Dump data from the device */
    for (reg=0; reg &lt; length; reg++) {
        /* See i2c-dev.h from the lm-sensors package for the
           implementation of the following inline function */
        res = i2c_smbus_read_byte_data(smbus_fp, (unsigned char) reg);
        if (res &lt; 0) {
            exit(1);
        }
        /* Dump data */
        /* ... */
    }

    /* ... */

    /* Switch to bank 2 */
    if (ioctl(smbus_fp, I2C_SLAVE, SLAVE_ADDR2) &lt; 0) {
        exit(1);
    }

    /* Clear bank 2 */
    for (reg=0; reg &lt; length; reg+=2){
        i2c_smbus_write_word_data(smbus_fp, (unsigned char) reg, 0x0);
    }

    /* ... */

    close(smbus_fp);
} 



syntax highlighted by Code2HTML, v. 0.9.1


lines: 0
