

  Listing 17.3




#include &lt;linux/mtd/mtd.h&gt;
#include &lt;linux/mtd/map.h&gt;
#include &lt;linux/ioport.h&gt;

static int
pda_mtd_probe(struct platform_device *pdev)
{
    struct map_info *pda_map;
    struct mtd_info *pda_mtd;
    struct resource *res = pdev-&gt;resource;

    /* Populate pda_map with information obtained
       from the associated platform device */
    pda_map-&gt;virt = ioremap_nocache(res-&gt;start,
                                    (res-&gt;end - res-&gt;start + 1));
    pda_map-&gt;name = pdev-&gt;dev.bus_id;
    pda_map-&gt;phys = res-&gt;start;
    pda_map-&gt;size = res-&gt;end - res-&gt;start + 1;
    pda_map-&gt;bankwidth = 2;    /* Two 16-bit banks sitting
                                  on a 32-bit bus */
    simple_map_init(&amp;pda_map); /* Fill in default access methods */

    /* Probe via the CFI chip driver */
    pda_mtd = do_map_probe(&quot;cfi_probe&quot;, &amp;pda_map);

    /* Register the mtd_partition structure */
    add_mtd_partitions(pda_mtd, pda_partitions, 3); /* Three Partitions */

    /* ... */
}
 



syntax highlighted by Code2HTML, v. 0.9.1


lines: 0
